# ğŸ¬ HeyGen Avatar Video å·¥ä½œæµæŒ‡å—

## ğŸ“‹ æ–°æ¶æ§‹ï¼šæ–¹æ¡ˆ Cï¼ˆåˆ†æ­¥ç¢ºèªæµç¨‹ï¼‰

```
Step 1: æ–‡æ¡ˆç”Ÿæˆèˆ‡å¯©æ ¸
   â†“
Step 2: èªéŸ³å…‹éš†ï¼ˆElevenLabsï¼‰
   â†“
   ã€ç”¨æˆ¶è©¦è½ä¸¦ç¢ºèªèªéŸ³ã€‘âœ“
   â†“
Step 3: Avatar Video ç”Ÿæˆï¼ˆHeyGenï¼‰
   â†“  â”œâ”€ è‡ªå‹•ä¸Šå‚³èªéŸ³
   â†“  â”œâ”€ è‡ªå‹•ä¸Šå‚³åœ–ç‰‡
   â†“  â”œâ”€ å‰µå»ºæ•¸ä½åˆ†èº«
   â†“  â””â”€ è‡ªå‹•å°å£å‹ + éŸ³ç•«åˆæˆ
   â†“
æœ€çµ‚å½±ç‰‡ï¼ˆæœƒèªªè©±çš„å¸‚é•·ï¼‰ğŸ‰
```

---

## âœ¨ ç‚ºä»€éº¼é¸æ“‡ HeyGenï¼Ÿ

### å°æ¯”è¡¨ï¼šRunway + FFmpeg vs HeyGen

| ç‰¹æ€§ | Runway + FFmpeg | **HeyGen** |
|------|----------------|------------|
| **å£å‹åŒæ­¥** | âŒ ç„¡å£å‹ï¼Œåªæ˜¯å‹•æ…‹åœ–ç‰‡ | âœ… **è‡ªå‹•å°å£å‹** |
| **éŸ³ç•«åˆæˆ** | âŒ éœ€è¦ FFmpeg æ‰‹å‹•è™•ç† | âœ… **å…§å»ºè‡ªå‹•åˆæˆ** |
| **æ­¥é©Ÿæ•¸é‡** | 3 æ­¥é©Ÿï¼ˆèªéŸ³ â†’ å½±ç‰‡ â†’ åˆæˆï¼‰ | **2 æ­¥é©Ÿ**ï¼ˆèªéŸ³ â†’ Avatarï¼‰ |
| **æ•¸ä½åˆ†èº«å“è³ª** | âŒ å‹•æ…‹åœ–ç‰‡ | âœ… **çœŸå¯¦ Avatar èªªè©±** |
| **éƒ¨ç½²è¤‡é›œåº¦** | éœ€è¦å®‰è£ FFmpeg | **ç´” API èª¿ç”¨** |
| **å°ˆæ¥­åº¦** | ä¸€èˆ¬ | **éå¸¸å°ˆæ¥­**ï¼ˆé©åˆæ”¿æ²»å®£å‚³ï¼‰ |
| **é©ç”¨å ´æ™¯** | ç°¡å–®å‹•æ…‹æ•ˆæœ | **å°ˆæ¥­æ•¸ä½åˆ†èº«å½±ç‰‡** |

### ğŸ¯ HeyGen çš„æ ¸å¿ƒå„ªå‹¢

1. **âœ… çœŸæ­£çš„æœƒèªªè©±å½±ç‰‡**ï¼šå£å‹å®Œç¾åŒæ­¥ï¼Œçœ‹èµ·ä¾†åƒå¸‚é•·çœŸçš„åœ¨èªªè©±
2. **âœ… ç°¡åŒ–æµç¨‹**ï¼šå¾ 3 æ­¥ç°¡åŒ–åˆ° 2 æ­¥ï¼Œçœæ‰éŸ³ç•«åˆæˆç’°ç¯€
3. **âœ… é›¶ç¶­è­·**ï¼šä¸éœ€è¦å®‰è£å’Œç¶­è­· FFmpeg
4. **âœ… æ›´ç¬¦åˆéœ€æ±‚**ï¼šæ”¿æ²»å®£å‚³éœ€è¦å°ˆæ¥­çš„æ•¸ä½åˆ†èº«æ•ˆæœ
5. **âœ… å…§å»ºå„ªåŒ–**ï¼šè‡ªå‹•è™•ç†å…‰å½±ã€è¡¨æƒ…ã€å‹•ä½œ

---

## ğŸ”„ å·¥ä½œæµç¨‹è©³è§£

### æ­¥é©Ÿ 1ï¼šæ–‡æ¡ˆç”Ÿæˆèˆ‡å¯©æ ¸

```http
POST /api/staff/content/generate
Content-Type: application/json
Authorization: Bearer {STAFF_PASSWORD}

{
  "topic": "ç’°ä¿æ”¿ç­–å®£å°",
  "style": "formal",
  "length": "medium"
}
```

**å›æ‡‰ï¼š**
```json
{
  "success": true,
  "task_id": "task_20250126123456",
  "content": "å„ä½å¸‚æ°‘æœ‹å‹å¤§å®¶å¥½...",
  "message": "æ–‡æ¡ˆç”Ÿæˆå®Œæˆï¼Œè«‹å¯©æ ¸"
}
```

**å‰ç«¯æ“ä½œï¼š**
1. ç”¨æˆ¶è¼¸å…¥ä¸»é¡Œ
2. AI ç”Ÿæˆæ–‡æ¡ˆ
3. å¹•åƒšå¯©æ ¸ä¸¦å¯èƒ½ä¿®æ”¹
4. é»æ“Šã€Œå¯©æ ¸é€šéã€

---

### æ­¥é©Ÿ 2ï¼šèªéŸ³å…‹éš†ï¼ˆç”¨æˆ¶ç¢ºèªç’°ç¯€ï¼‰

```http
POST /api/staff/media/voice/{task_id}
Authorization: Bearer {STAFF_PASSWORD}
```

**å›æ‡‰ï¼š**
```json
{
  "success": true,
  "task_id": "task_20250126123456",
  "media_type": "voice",
  "file_path": "generated_content/voices/task_20250126123456.mp3",
  "message": "èªéŸ³ç”Ÿæˆå®Œæˆ"
}
```

**å‰ç«¯æ“ä½œï¼š**
1. é»æ“Šã€Œç”ŸæˆèªéŸ³ã€
2. ç­‰å¾… 10-20 ç§’
3. **é¡¯ç¤ºéŸ³é »æ’­æ”¾å™¨** ğŸµ
4. **ç”¨æˆ¶è©¦è½** âœ“
5. ç¢ºèªæ»¿æ„å¾Œï¼Œé»æ“Šã€Œç”Ÿæˆå½±ç‰‡ã€

**é‡è¦ç‰¹é»ï¼š**
- â¸ï¸ **æš«åœé»**ï¼šç”¨æˆ¶å¯ä»¥åœ¨é€™è£¡ç¢ºèªèªéŸ³æ˜¯å¦æ»¿æ„
- ğŸ”„ **å¯é‡æ–°ç”Ÿæˆ**ï¼šå¦‚æœä¸æ»¿æ„ï¼Œå¯ä»¥ä¿®æ”¹æ–‡æ¡ˆé‡æ–°ç”Ÿæˆ
- âœ… **ç¢ºèªå¾Œæ‰é€²å…¥å½±ç‰‡ç”Ÿæˆ**ï¼šé¿å…æµªè²»å½±ç‰‡ç”Ÿæˆè³‡æº

---

### æ­¥é©Ÿ 3ï¼šAvatar Video ç”Ÿæˆ

```http
POST /api/staff/media/avatar-video/{task_id}?image_path=...
Authorization: Bearer {STAFF_PASSWORD}
```

**åƒæ•¸ï¼š**
- `image_path`: å¸‚é•·ç…§ç‰‡è·¯å¾‘ï¼ˆå¿…å¡«ï¼‰

**HeyGen å…§éƒ¨æµç¨‹ï¼š**
```
1. æª¢æŸ¥èªéŸ³æ–‡ä»¶æ˜¯å¦å­˜åœ¨ âœ“
2. ä¸Šå‚³éŸ³é »åˆ° HeyGen ğŸ“¤
3. ä¸Šå‚³åœ–ç‰‡ä¸¦å‰µå»º Avatar ğŸ“¸
4. å‰µå»º Avatar Video ä»»å‹™ ğŸ¬
5. è¼ªè©¢ç‹€æ…‹ï¼ˆ5-10 åˆ†é˜ï¼‰â³
   â””â”€ queued â†’ processing â†’ completed
6. ä¸‹è¼‰æœ€çµ‚å½±ç‰‡ ğŸ“¥
```

**å›æ‡‰ï¼š**
```json
{
  "success": true,
  "task_id": "task_20250126123456",
  "media_type": "avatar_video",
  "file_path": "generated_content/videos/task_20250126123456.mp4",
  "message": "Avatar Video ç”Ÿæˆå®Œæˆï¼å¸‚é•·æ•¸ä½åˆ†èº«å·²ç”Ÿæˆ"
}
```

**ç‰¹è‰²åŠŸèƒ½ï¼š**
- âœ… **è‡ªå‹•å°å£å‹**ï¼šHeyGen è‡ªå‹•åˆ†æèªéŸ³ï¼Œè®“å˜´å‹å®Œç¾åŒæ­¥
- âœ… **è¡¨æƒ…ç”Ÿå‹•**ï¼šæ ¹æ“šèªèª¿è‡ªå‹•èª¿æ•´è¡¨æƒ…
- âœ… **å…‰å½±è‡ªç„¶**ï¼šå°ˆæ¥­ç´šå½±ç‰‡æ¸²æŸ“
- âœ… **é«˜è§£æåº¦**ï¼š1280x720 HD å“è³ª

---

## ğŸ“Š å‰ç«¯ UI æµç¨‹

### å¹•åƒšç³»çµ±é é¢ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ­¥é©Ÿ 1: æ–‡æ¡ˆç”Ÿæˆèˆ‡å¯©æ ¸              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ä¸»é¡Œ] ç’°ä¿æ”¿ç­–å®£å°                         â”‚
â”‚ [é¢¨æ ¼] æ­£å¼ â–¼  [é•·åº¦] ä¸­ç­‰ â–¼               â”‚
â”‚ [ç”Ÿæˆæ–‡æ¡ˆ] æŒ‰éˆ•                             â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ å„ä½å¸‚æ°‘æœ‹å‹å¤§å®¶å¥½ï¼Œ         â”‚         â”‚
â”‚ â”‚ ä»Šå¤©æˆ‘æƒ³è·Ÿå¤§å®¶è«‡è«‡ç’°ä¿æ”¿ç­–... â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                             â”‚
â”‚ [å¯©æ ¸é€šé] æŒ‰éˆ•                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ­¥é©Ÿ 2: èªéŸ³ç”Ÿæˆï¼ˆç¢ºèªç’°ç¯€ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [éŸ³è‰²é¸æ“‡]                                  â”‚
â”‚  â—‹ å°ˆæ¥­ã€åš´è¬¹  â—‹ è¦ªå’Œã€æº«æš–               â”‚
â”‚  â—‹ é–‹å¿ƒã€ç†±æƒ…  â—‹ é›£éã€æ„Ÿå‚·               â”‚
â”‚                                             â”‚
â”‚ [ç”ŸæˆèªéŸ³] æŒ‰éˆ•                             â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€ éŸ³é »æ’­æ”¾å™¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ ğŸµ ç”Ÿæˆçš„èªéŸ³                â”‚          â”‚
â”‚ â”‚ [â–¶ï¸ æ’­æ”¾] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚          â”‚
â”‚ â”‚ ä»»å‹™ID: task_123...          â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                             â”‚
â”‚ âš ï¸ è«‹å…ˆè©¦è½èªéŸ³ï¼Œç¢ºèªæ»¿æ„å¾Œå†ç”Ÿæˆå½±ç‰‡      â”‚
â”‚                                             â”‚
â”‚ [å„²å­˜éŸ³æª”] [é‡æ–°ç”Ÿæˆ] [ç¢ºèªä¸¦ç”Ÿæˆå½±ç‰‡]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ­¥é©Ÿ 3: Avatar Video ç”Ÿæˆ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ä¸Šå‚³å¸‚é•·ç…§ç‰‡]                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                          â”‚
â”‚ â”‚ğŸ“¸åœ–  â”‚ â”‚ ï¼‹  â”‚                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                             â”‚
â”‚ [ç”Ÿæˆ Avatar Video] æŒ‰éˆ•                    â”‚
â”‚                                             â”‚
â”‚ â³ æ­£åœ¨ç”Ÿæˆä¸­... (é è¨ˆ 5-10 åˆ†é˜)          â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€ å½±ç‰‡é è¦½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚ ğŸ¬ å¸‚é•·æ•¸ä½åˆ†èº«             â”‚           â”‚
â”‚ â”‚ [â–¶ï¸ æ’­æ”¾]                   â”‚           â”‚
â”‚ â”‚ (æœƒèªªè©±çš„å¸‚é•·å½±ç‰‡)          â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                             â”‚
â”‚ [ä¸‹è¼‰å½±ç‰‡] æŒ‰éˆ•                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ å‰ç«¯ API æ•´åˆ

### æ›´æ–° `api-client.js`

```javascript
class APIClient {
    static staff = {
        // ... ç¾æœ‰æ–¹æ³• ...

        /**
         * ç”Ÿæˆ Avatar Videoï¼ˆæ–°ç«¯é»ï¼‰
         */
        async generateAvatarVideo(taskId, imagePath) {
            try {
                const queryParams = `image_path=${encodeURIComponent(imagePath)}`;
                const data = await request(
                    `${API_CONFIG.staffURL}/media/avatar-video/${taskId}?${queryParams}`,
                    {
                        method: 'POST',
                        requireAuth: true
                    }
                );
                return { success: true, ...data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
    };
}

// å‘å¾Œå…¼å®¹
export const generateAvatarVideo = APIClient.staff.generateAvatarVideo.bind(APIClient.staff);
```

### æ›´æ–° `video-generator.js`

```javascript
import { showNotification } from '../utils/notification.js';
import APIClient from '../api/api-client.js';

let currentTaskId = null;
let voiceConfirmed = false; // æ–°å¢ï¼šèªéŸ³ç¢ºèªæ¨™è¨˜

/**
 * ç”Ÿæˆ Avatar Videoï¼ˆæ–°æµç¨‹ï¼‰
 */
async function handleAvatarVideoGenerate() {
    // æª¢æŸ¥èªéŸ³æ˜¯å¦å·²ç¢ºèª
    if (!voiceConfirmed) {
        showNotification(
            'è«‹å…ˆç”Ÿæˆä¸¦ç¢ºèªèªéŸ³ï¼',
            'warning'
        );
        return;
    }

    // æª¢æŸ¥æ˜¯å¦æœ‰ä¸Šå‚³çš„ç…§ç‰‡
    if (!uploadedPhotoPaths || uploadedPhotoPaths.length === 0) {
        showNotification('è«‹å…ˆä¸Šå‚³å¸‚é•·ç…§ç‰‡', 'warning');
        return;
    }

    try {
        showNotification(
            'æ­£åœ¨ç”Ÿæˆ Avatar Videoï¼Œé è¨ˆéœ€è¦ 5-10 åˆ†é˜...',
            'info'
        );

        const imagePath = uploadedPhotoPaths[0];

        // èª¿ç”¨æ–°çš„ Avatar Video API
        const result = await APIClient.staff.generateAvatarVideo(
            currentTaskId,
            imagePath
        );

        if (!result.success) {
            showNotification(`ç”Ÿæˆå¤±æ•—: ${result.error}`, 'error');
            return;
        }

        showNotification('Avatar Video ç”Ÿæˆå®Œæˆï¼', 'success');

        // é¡¯ç¤ºå½±ç‰‡æ’­æ”¾å™¨
        displayVideoPlayer(result.file_path);

    } catch (error) {
        console.error('âŒ Avatar Video ç”ŸæˆéŒ¯èª¤:', error);
        showNotification('ç”Ÿæˆéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤', 'error');
    }
}

/**
 * ç¢ºèªèªéŸ³ï¼ˆæ–°åŠŸèƒ½ï¼‰
 */
function confirmVoice() {
    if (!generatedAudioUrl) {
        showNotification('è«‹å…ˆç”ŸæˆèªéŸ³', 'warning');
        return;
    }

    voiceConfirmed = true;
    showNotification('èªéŸ³å·²ç¢ºèªï¼ç¾åœ¨å¯ä»¥ç”Ÿæˆå½±ç‰‡äº†', 'success');

    // å•Ÿç”¨ã€Œç”Ÿæˆå½±ç‰‡ã€æŒ‰éˆ•
    const generateBtn = document.getElementById('btnGenVideo');
    if (generateBtn) {
        generateBtn.disabled = false;
        generateBtn.textContent = 'âœ¨ ç”Ÿæˆ Avatar Video';
    }
}
```

---

## ğŸ”§ ç’°å¢ƒé…ç½®

### `.env` æ–‡ä»¶

```bash
# Gemini API
GEMINI_API_KEY=your_gemini_api_key

# ElevenLabs èªéŸ³å…‹éš†
ELEVENLABS_API_KEY=your_elevenlabs_api_key
MAYOR_VOICE_ID=your_mayor_voice_id

# HeyGen Avatar Videoï¼ˆNEWï¼ï¼‰
HEYGEN_API_KEY=your_heygen_api_key

# ç³»çµ±é…ç½®
STAFF_PASSWORD=admin123
ADMIN_PASSWORD=admin123456
```

### Docker Compose

```yaml
staff_api:
  build: ./rag_service
  environment:
    - GEMINI_API_KEY=${GEMINI_API_KEY}
    - ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}
    - MAYOR_VOICE_ID=${MAYOR_VOICE_ID}
    - HEYGEN_API_KEY=${HEYGEN_API_KEY}  # NEW!
    - STAFF_PASSWORD=${STAFF_PASSWORD}
```

---

## âš¡ æ€§èƒ½å°æ¯”

### èˆŠæ¶æ§‹ï¼ˆRunway + FFmpegï¼‰

```
Step 1: èªéŸ³ç”Ÿæˆ (15ç§’)
Step 2: Runway å½±ç‰‡ç”Ÿæˆ (180ç§’)
Step 3: FFmpeg éŸ³ç•«åˆæˆ (10ç§’)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½æ™‚é–“: 205ç§’
```

### æ–°æ¶æ§‹ï¼ˆHeyGenï¼‰

```
Step 1: èªéŸ³ç”Ÿæˆ (15ç§’)
   â†“
   ã€ç”¨æˆ¶ç¢ºèªã€‘
   â†“
Step 2: HeyGen Avatar Video (300-600ç§’)
   â”œâ”€ è‡ªå‹•ä¸Šå‚³éŸ³é »
   â”œâ”€ è‡ªå‹•ä¸Šå‚³åœ–ç‰‡
   â”œâ”€ å‰µå»º Avatar
   â”œâ”€ å°å£å‹ + éŸ³ç•«åˆæˆ
   â””â”€ æ¸²æŸ“å½±ç‰‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½æ™‚é–“: ~5-10åˆ†é˜
```

**å°æ¯”åˆ†æï¼š**
- âŒ ç¸½æ™‚é–“ç¨é•·ï¼ˆHeyGen æ¸²æŸ“éœ€è¦æ™‚é–“ï¼‰
- âœ… **å“è³ªå¤§å¹…æå‡**ï¼ˆçœŸå¯¦å°å£å‹ vs å‹•æ…‹åœ–ç‰‡ï¼‰
- âœ… **ç”¨æˆ¶é«”é©—æ›´å¥½**ï¼ˆæœ‰ç¢ºèªç’°ç¯€ï¼‰
- âœ… **éƒ¨ç½²æ›´ç°¡å–®**ï¼ˆç„¡éœ€ FFmpegï¼‰

---

## ğŸ¯ HeyGen API è©³è§£

### 1. ä¸Šå‚³éŸ³é »

```python
async def upload_audio(self, audio_path: str) -> str:
    url = f"{self.base_url}/audio/upload"
    headers = {"X-Api-Key": self.api_key}

    with open(audio_path, "rb") as f:
        files = {"file": f}
        response = await client.post(url, headers=headers, files=files)

    return data["data"]["url"]  # è¿”å›éŸ³é » URL
```

### 2. å‰µå»º Avatar

```python
async def upload_image(self, image_path: str) -> str:
    url = f"{self.base_url}/avatar/upload"
    headers = {"X-Api-Key": self.api_key}

    with open(image_path, "rb") as f:
        files = {"file": f}
        response = await client.post(url, headers=headers, files=files)

    return data["data"]["avatar_id"]  # è¿”å› Avatar ID
```

### 3. ç”Ÿæˆ Avatar Video

```python
async def _create_video(self, avatar_id: str, audio_url: str) -> str:
    url = f"{self.base_url}/video/generate"
    payload = {
        "video_inputs": [
            {
                "character": {
                    "type": "avatar",
                    "avatar_id": avatar_id
                },
                "voice": {
                    "type": "audio",
                    "audio_url": audio_url
                },
                "background": {
                    "type": "color",
                    "value": "#FFFFFF"
                }
            }
        ],
        "dimension": {
            "width": 1280,
            "height": 720
        }
    }

    response = await client.post(url, json=payload, headers=headers)
    return data["data"]["video_id"]
```

### 4. è¼ªè©¢ç‹€æ…‹

```python
async def _poll_video_status(self, video_id: str) -> str:
    url = f"{self.base_url}/video/{video_id}"

    while True:
        response = await client.get(url, headers=headers)
        status = data["data"]["status"]

        if status == "completed":
            return data["data"]["video_url"]

        await asyncio.sleep(10)  # æ¯10ç§’æª¢æŸ¥ä¸€æ¬¡
```

---

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q1: HeyGen API Key å¦‚ä½•ç²å–ï¼Ÿ

**A:**
1. å‰å¾€ https://app.heygen.com
2. è¨»å†Šä¸¦ç™»å…¥
3. é€²å…¥ Settings â†’ API Keys
4. å‰µå»ºæ–°çš„ API Key
5. è¤‡è£½åˆ° `.env` æ–‡ä»¶çš„ `HEYGEN_API_KEY`

### Q2: å½±ç‰‡ç”Ÿæˆéœ€è¦å¤šä¹…ï¼Ÿ

**A:** é€šå¸¸ 5-10 åˆ†é˜ï¼Œå…·é«”å–æ±ºæ–¼ï¼š
- èªéŸ³é•·åº¦
- HeyGen æœå‹™å™¨è² è¼‰
- å½±ç‰‡å“è³ªè¨­å®š

### Q3: å¯ä»¥è‡ªè¨‚èƒŒæ™¯å—ï¼Ÿ

**A:** å¯ä»¥ï¼åœ¨ `heygen_service.py` ä¸­ä¿®æ”¹ï¼š
```python
"background": {
    "type": "image",  # æ”¹ç‚ºåœ–ç‰‡
    "url": "èƒŒæ™¯åœ–ç‰‡URL"
}
```

### Q4: å¦‚æœèªéŸ³ä¸æ»¿æ„æ€éº¼è¾¦ï¼Ÿ

**A:** é€™å°±æ˜¯æ–¹æ¡ˆ C çš„å„ªå‹¢ï¼š
1. åœ¨èªéŸ³ç”Ÿæˆå¾Œï¼Œå‰ç«¯æœƒé¡¯ç¤ºæ’­æ”¾å™¨
2. ç”¨æˆ¶å¯ä»¥è©¦è½
3. å¦‚æœä¸æ»¿æ„ï¼Œä¿®æ”¹æ–‡æ¡ˆé‡æ–°ç”Ÿæˆ
4. **åªæœ‰ç¢ºèªå¾Œæ‰é€²å…¥å½±ç‰‡ç”Ÿæˆ**ï¼Œé¿å…æµªè²»è³‡æº

---

## ğŸ¯ ç¸½çµ

### âœ… æ–°æ¶æ§‹å„ªå‹¢

1. **çœŸå¯¦å°å£å‹** - HeyGen å°ˆæ¥­ç´š Avatar æŠ€è¡“
2. **åˆ†æ­¥ç¢ºèª** - ç”¨æˆ¶å¯ä»¥åœ¨ç”Ÿæˆå½±ç‰‡å‰ç¢ºèªèªéŸ³
3. **ç°¡åŒ–éƒ¨ç½²** - ä¸éœ€è¦ FFmpeg
4. **æ›´å°ˆæ¥­** - é©åˆæ”¿æ²»å®£å‚³çš„é«˜å“è³ªå½±ç‰‡

### ğŸ“¦ å®Œæ•´æŠ€è¡“æ£§

- **æ–‡æ¡ˆç”Ÿæˆ**: Gemini 2.0 Flash + LangChain
- **èªéŸ³å…‹éš†**: ElevenLabs Turbo v2.5
- **Avatar Video**: HeyGen API
- **å‰ç«¯**: ES6 Modules
- **å¾Œç«¯**: FastAPI + Async

### ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

```bash
# 1. è¨­å®šç’°å¢ƒè®Šæ•¸
nano .env  # æ·»åŠ  HEYGEN_API_KEY

# 2. é‡æ–°æ§‹å»ºæœå‹™
docker compose build --no-cache staff_api

# 3. å•Ÿå‹•æœå‹™
docker compose up -d

# 4. æ¸¬è©¦
# æ‰“é–‹ admin.html â†’ ç”Ÿæˆæ–‡æ¡ˆ â†’ ç”ŸæˆèªéŸ³ â†’ ç¢ºèª â†’ ç”Ÿæˆå½±ç‰‡
```

---

**ç¾åœ¨ä½ æ“æœ‰ä¸€å€‹çœŸæ­£å°ˆæ¥­çš„æ•¸ä½åˆ†èº«å½±ç‰‡ç”Ÿæˆç³»çµ±ï¼** ğŸ‰
