# PAIS - æ”¿å‹™åˆ†èº«æ™ºèƒ½ç³»çµ±

> åŸºæ–¼ LangChain + Gemini + Docker çš„å¸‚é•·èŠå¤©æ©Ÿå™¨äºº
> 
> **åŠŸèƒ½ï¼š** æ°‘çœ¾å•ç­” + åœ˜éšŠæ–‡æ¡ˆç”Ÿæˆ + çŸ¥è­˜åº«ç®¡ç†

---

## ğŸ“¦ ç³»çµ±æ¶æ§‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (Nginx)                            â”‚
â”‚  - æ°‘çœ¾èŠå¤©ä»‹é¢                          â”‚
â”‚  - åœ˜éšŠå¾Œå°ç®¡ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¾Œç«¯ API (FastAPI + LangChain)          â”‚
â”‚  - RAG å•ç­” (Agent + Memory)            â”‚
â”‚  - æ–‡æ¡ˆç”Ÿæˆ (Chain)                      â”‚
â”‚  - çŸ¥è­˜åº«ç®¡ç† (Document Loaders)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é‡è³‡æ–™åº« (Qdrant)                     â”‚
â”‚  - å„²å­˜æ–‡ä»¶å‘é‡                          â”‚
â”‚  - èªç¾©æœå°‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1ï¸âƒ£ å‰ç½®éœ€æ±‚

- âœ… Docker Desktop
- âœ… Gemini API Key ([å–å¾—é€£çµ](https://makersuite.google.com/app/apikey))

### 2ï¸âƒ£ å®‰è£æ­¥é©Ÿ
```bash
# 1. è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.example .env

# 2. ç·¨è¼¯ .envï¼Œå¡«å…¥ä½ çš„ API Key
nano .env

# 3. å»ºç«‹ä¸¦å•Ÿå‹•æ‰€æœ‰å®¹å™¨
docker-compose up -d --build

# 4. æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f rag_api
```

### 3ï¸âƒ£ ä¸Šå‚³çŸ¥è­˜åº«

**æ–¹å¼ä¸€ï¼šæ”¾å…¥æª”æ¡ˆå¾Œæ‰¹é‡è™•ç†**
```bash
# 1. å°‡æ–‡ä»¶æ”¾å…¥ documents/ è³‡æ–™å¤¾
cp ä½ çš„æ–‡ä»¶.pdf documents/

# 2. è§¸ç™¼å‘é‡åŒ–
curl -X POST http://localhost:8000/api/ingest \
  -H "Authorization: Bearer ä½ çš„ç®¡ç†å“¡å¯†ç¢¼" \
  -H "Content-Type: application/json" \
  -d '{"folder_path": "documents"}'
```

**æ–¹å¼äºŒï¼šé€éç¶²é ä¸Šå‚³**
- è¨ªå•å¾Œå°ä¸Šå‚³é é¢
- é¸æ“‡æª”æ¡ˆä¸Šå‚³ï¼ˆæœƒè‡ªå‹•å‘é‡åŒ–ï¼‰

## ğŸŒ è¨ªå•ç¶²å€

| æœå‹™ | ç¶²å€ | ç”¨é€” |
|------|------|------|
| æ°‘çœ¾èŠå¤©é é¢ | http://localhost | å…¬é–‹è¨ªå• |
| åœ˜éšŠå¾Œå° | http://localhost/admin.html | éœ€è¦å¯†ç¢¼ |
| API æ–‡ä»¶ | http://localhost:8000/docs | Swagger UI |
| Qdrant æ§åˆ¶å° | http://localhost:6333/dashboard | å‘é‡è³‡æ–™åº« |

---

## ğŸ“š API ä½¿ç”¨èªªæ˜

### ğŸŸ¢ æ°‘çœ¾ç«¯ APIï¼ˆå…¬é–‹ï¼‰

#### 1. å°è©±å•ç­”
```bash
POST /api/chat

{
  "message": "å¸‚é•·æœ€è¿‘åœ¨æ¨å‹•ä»€éº¼æ”¿ç­–ï¼Ÿ",
  "session_id": "user_123",  # å¯é¸
  "use_agent": true          # æ˜¯å¦ä½¿ç”¨ Agent
}
```

**å›æ‡‰ç¯„ä¾‹ï¼š**
```json
{
  "reply": "å¸‚é•·ç›®å‰æ­£åœ¨æ¨å‹•æ™ºæ…§åŸå¸‚è¨ˆç•«...",
  "sources": ["documents/æ”¿ç­–ç™½çš®æ›¸.pdf"],
  "session_id": "user_123",
  "timestamp": "2025-10-28T10:30:00",
  "thought_process": "..."
}
```

#### 2. æŸ¥çœ‹å°è©±è¨˜æ†¶
```bash
GET /api/memory/{session_id}
```

### ğŸ”´ åœ˜éšŠå¾Œå° APIï¼ˆéœ€è¦å¯†ç¢¼ï¼‰

æ‰€æœ‰è«‹æ±‚éœ€è¦åœ¨ Header åŠ ä¸Šï¼š
```
Authorization: Bearer ä½ çš„ç®¡ç†å“¡å¯†ç¢¼
```

#### 1. ç”Ÿæˆæ–‡æ¡ˆ
```bash
POST /api/generate

{
  "topic": "æ¡ƒåœ’æ™ºæ…§åŸå¸‚è¨ˆç•«",
  "style": "è¼•é¬†",
  "length": "ä¸­"
}
```

#### 2. ä¸Šå‚³æª”æ¡ˆ
```bash
POST /api/upload
Content-Type: multipart/form-data

file: [ä½ çš„æª”æ¡ˆ]
```

#### 3. æ‰¹é‡è™•ç†çŸ¥è­˜åº«
```bash
POST /api/ingest

{
  "folder_path": "documents"
}
```

#### 4. æ¸…é™¤å°è©±è¨˜æ†¶
```bash
DELETE /api/memory/{session_id}
```

---

## ğŸ—‚ï¸ è³‡æ–™å¤¾çµæ§‹
```
PAIS-Project/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env
â”œâ”€â”€ nginx.conf
â”œâ”€â”€ setup.sh
â”‚
â”œâ”€â”€ rag_service/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ index.css
â”‚   â”œâ”€â”€ people.js
â”‚   â”œâ”€â”€ admin.html
â”‚   â”œâ”€â”€ admin.css
â”‚   â”œâ”€â”€ admin.js
â”‚   â””â”€â”€ api.js
â”‚
â”œâ”€â”€ documents/          # ğŸ“ çŸ¥è­˜åº«æ–‡ä»¶
â”œâ”€â”€ chat_history/       # ğŸ’¬ å°è©±è¨˜éŒ„
â”œâ”€â”€ generated_content/  # âœï¸ ç”Ÿæˆçš„æ–‡æ¡ˆ
â”œâ”€â”€ logs/              # ğŸ“Š ç³»çµ±æ—¥èªŒ
â””â”€â”€ qdrant_storage/    # ğŸ—„ï¸ å‘é‡è³‡æ–™åº«
```

---

## ğŸ”§ LangChain æ¶æ§‹èªªæ˜

### æ ¸å¿ƒå…ƒä»¶

| å…ƒä»¶ | ç”¨é€” | å¯¦ä½œ |
|------|------|------|
| **Agents** | æ™ºèƒ½ä»£ç† | ReAct Agent + 3 å·¥å…· |
| **Memory** | å°è©±è¨˜æ†¶ | ConversationBufferMemory |
| **RAG** | æª¢ç´¢å¢å¼·ç”Ÿæˆ | ConversationalRetrievalChain |
| **Chains** | å·¥ä½œæµç¨‹ | LLMChain (æ–‡æ¡ˆç”Ÿæˆ) |
| **Tools** | Agent å·¥å…· | æœå°‹çŸ¥è­˜åº«ã€æŸ¥è©¢æ”¿ç­–ã€å„²å­˜å…§å®¹ |

---

## ğŸ› ï¸ å¸¸ç”¨æŒ‡ä»¤
```bash
# å•Ÿå‹•æœå‹™
docker-compose up -d

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f rag_api

# åœæ­¢æœå‹™
docker-compose down

# é‡æ–°å»ºç½®
docker-compose up -d --build

# é€²å…¥å®¹å™¨
docker exec -it pais-backend bash

# æŸ¥çœ‹ç³»çµ±ç‹€æ…‹
curl http://localhost:8000/health

# æŸ¥çœ‹çµ±è¨ˆè³‡è¨Š
curl http://localhost:8000/api/stats
```

---

## ğŸ“ ç’°å¢ƒè®Šæ•¸èªªæ˜
```bash
# .env æª”æ¡ˆå…§å®¹

# Gemini API Key (å¿…å¡«)
GEMINI_API_KEY=ä½ çš„_API_é‡‘é‘°

# ç®¡ç†å“¡å¯†ç¢¼ (å¿…å¡«)
ADMIN_PASSWORD=ä½ çš„å¼·å¯†ç¢¼

# Qdrant è¨­å®š
QDRANT_HOST=qdrant
QDRANT_PORT=6333
```

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šå®¹å™¨å•Ÿå‹•å¤±æ•—
```bash
# æª¢æŸ¥ .env æ˜¯å¦æ­£ç¢ºè¨­å®š
cat .env

# æŸ¥çœ‹è©³ç´°éŒ¯èª¤
docker-compose logs rag_api
```

### å•é¡Œ 2ï¼šAPI å›æ‡‰ 401 æœªæˆæ¬Š
```bash
# ç¢ºèª Authorization Header æ ¼å¼
Authorization: Bearer ä½ çš„ç®¡ç†å“¡å¯†ç¢¼
```

### å•é¡Œ 3ï¼šçŸ¥è­˜åº«æœå°‹ç„¡çµæœ
```bash
# æª¢æŸ¥æ˜¯å¦å·²ä¸Šå‚³æ–‡ä»¶
curl http://localhost:8000/api/stats

# é‡æ–°è™•ç†çŸ¥è­˜åº«
curl -X POST http://localhost:8000/api/ingest \
  -H "Authorization: Bearer å¯†ç¢¼" \
  -H "Content-Type: application/json" \
  -d '{"folder_path": "documents"}'