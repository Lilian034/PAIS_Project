# PAIS - æ”¿å‹™åˆ†èº«æ™ºèƒ½ç³»çµ±

> åŸºæ–¼ LangChain + Gemini + Docker çš„å¸‚é•·æ™ºèƒ½åŠ©ç†
> 
> **åŠŸèƒ½ï¼š** æ°‘çœ¾å•ç­” + å¹•åƒšæ–‡æ¡ˆç”Ÿæˆ + çŸ¥è­˜åº«ç®¡ç†

---

## ğŸ“¦ ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (Nginx)                            â”‚
â”‚  - æ°‘çœ¾èŠå¤©ä»‹é¢ (index.html)            â”‚
â”‚  - å¹•åƒšç³»çµ±ä»‹é¢ (admin.html)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
      â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚æ°‘çœ¾å•ç­”APIâ”‚  â”‚å¹•åƒšç³»çµ±APIâ”‚
â”‚  8000    â”‚  â”‚   8001   â”‚
â”‚          â”‚  â”‚          â”‚
â”‚ RAG å•ç­” â”‚  â”‚ æ–‡æ¡ˆç”Ÿæˆ â”‚
â”‚ + Memory â”‚  â”‚ + Memory â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â”‚Qdrant å‘é‡åº«â”‚
     â”‚   6333     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### 1ï¸âƒ£ æ°‘çœ¾å•ç­”ç³»çµ± (port 8000)
- ğŸ¤– AI èŠå¤©æ©Ÿå™¨äºº (Agent + Memory)
- ğŸ“š RAG çŸ¥è­˜åº«å•ç­”
- ğŸ’¬ å°è©±è¨˜æ†¶åŠŸèƒ½
- ğŸ¯ èªæ°£æ¨¡ä»¿

### 2ï¸âƒ£ å¹•åƒšç³»çµ± (port 8001)
- âœï¸ **æ–‡æ¡ˆç”Ÿæˆ** (LLM + Memory + RAG)
  - è‡ªå‹•å¾çŸ¥è­˜åº«æª¢ç´¢è³‡æ–™
  - å­¸ç¿’å¸‚é•·ç”¨å­—é£è©
  - æŒçºŒå„ªåŒ–ç”Ÿæˆå“è³ª
  
- âœï¸ **æ–‡æ¡ˆå¯©æ ¸**
  - äººå·¥ä¿®æ”¹èˆ‡å„ªåŒ–
  - ç‰ˆæœ¬æ§åˆ¶
  - ä¿®æ”¹è¨˜éŒ„ä½œç‚ºå­¸ç¿’æ¨£æœ¬

- ğŸ¤ **èªéŸ³å…‹éš†** (ElevenLabs)
  - æ–‡å­—è½‰èªéŸ³
  - å…‹éš†å¸‚é•·è²éŸ³
  
- ğŸ¬ **å½±ç‰‡ç”Ÿæˆ** (Runway)
  - åœ–ç‰‡è½‰å‹•æ…‹å½±ç‰‡

- ğŸ“š **çŸ¥è­˜åº«ç®¡ç†**
  - æ–‡ä»¶ä¸Šå‚³
  - è‡ªå‹•å‘é‡åŒ–

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚
- Docker Desktop
- docker-compose

### 1. è¨­å®šç’°å¢ƒè®Šæ•¸

è¤‡è£½ `.env.example` ç‚º `.env` ä¸¦å¡«å…¥ API Keys:

```bash
cp .env.example .env
```

ç·¨è¼¯ `.env`:
```bash
# å¿…å¡«
GEMINI_API_KEY=your_gemini_api_key

# é¸å¡« (æ²’å¡«å°æ‡‰åŠŸèƒ½ç„¡æ³•ä½¿ç”¨)
ELEVENLABS_API_KEY=your_elevenlabs_key  # èªéŸ³å…‹éš†
MAYOR_VOICE_ID=your_voice_id             # èªéŸ³å…‹éš†
RUNWAY_API_KEY=your_runway_key           # å½±ç‰‡ç”Ÿæˆ
```

### 2. ä¸€éµéƒ¨ç½²

```bash
chmod +x setup.sh
./setup.sh
```

### 3. è¨ªå•ç³»çµ±

| æœå‹™ | ç¶²å€ | èªªæ˜ |
|------|------|------|
| æ°‘çœ¾èŠå¤© | http://localhost | å…¬é–‹è¨ªå• |
| å¹•åƒšå¾Œå° | http://localhost/admin.html | éœ€è¦å¯†ç¢¼ |
| æ°‘çœ¾ API | http://localhost:8000/docs | Swagger UI |
| å¹•åƒš API | http://localhost:8001/docs | Swagger UI |
| Qdrant | http://localhost:6333/dashboard | å‘é‡è³‡æ–™åº« |

---

## ğŸ—‚ï¸ å°ˆæ¡ˆçµæ§‹

```
PAIS_Project/
â”œâ”€â”€ frontend/                # å‰ç«¯æª”æ¡ˆ
â”‚   â”œâ”€â”€ index.html          # æ°‘çœ¾èŠå¤©ä»‹é¢
â”‚   â”œâ”€â”€ admin.html          # å¹•åƒšç³»çµ±ä»‹é¢
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ rag_service/            # å¾Œç«¯æœå‹™
â”‚   â”œâ”€â”€ public_service.py   # æ°‘çœ¾å•ç­” API (8000)
â”‚   â”œâ”€â”€ staff_service.py    # å¹•åƒšç³»çµ± API (8001)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/             # è³‡æ–™æ¨¡å‹
â”‚   â”œâ”€â”€ services/           # æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ content_generator.py    # æ–‡æ¡ˆç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ memory_manager.py       # è¨˜æ†¶ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ elevenlabs_service.py   # èªéŸ³æœå‹™
â”‚   â”‚   â””â”€â”€ runway_service.py       # å½±ç‰‡æœå‹™
â”‚   â”‚
â”‚   â””â”€â”€ utils/              # å·¥å…·æ¨¡çµ„
â”‚       â”œâ”€â”€ db_helper.py            # è³‡æ–™åº«
â”‚       â””â”€â”€ task_manager.py         # ä»»å‹™ç®¡ç†
â”‚
â”œâ”€â”€ documents/              # ğŸ“ çŸ¥è­˜åº«æ–‡ä»¶
â”‚
â”œâ”€â”€ chat_history/           # ğŸ’¬ å°è©±è¨˜éŒ„
â”‚   â”œâ”€â”€ public/            # æ°‘çœ¾å°è©±
â”‚   â””â”€â”€ staff/             # å¹•åƒšè¨˜æ†¶
â”‚
â”œâ”€â”€ generated_content/      # âœï¸ ç”Ÿæˆå…§å®¹
â”‚   â”œâ”€â”€ drafts/            # è‰ç¨¿
â”‚   â”œâ”€â”€ approved/          # å·²å¯©æ ¸
â”‚   â”œâ”€â”€ voices/            # èªéŸ³æª”
â”‚   â””â”€â”€ videos/            # å½±ç‰‡æª”
â”‚
â”œâ”€â”€ database/              # ğŸ—„ï¸ SQLite è³‡æ–™åº«
â”‚   â””â”€â”€ staff_system.db
â”‚
â”œâ”€â”€ logs/                  # ğŸ“Š ç³»çµ±æ—¥èªŒ
â”œâ”€â”€ qdrant_storage/        # ğŸ—„ï¸ å‘é‡è³‡æ–™åº«
â”‚
â”œâ”€â”€ docker-compose.yml     # Docker é…ç½®
â”œâ”€â”€ nginx.conf            # Nginx é…ç½®
â”œâ”€â”€ .env                  # ç’°å¢ƒè®Šæ•¸
â””â”€â”€ setup.sh              # å¿«é€Ÿéƒ¨ç½²è…³æœ¬
```

---

## ğŸ”§ å¹•åƒšç³»çµ±å·¥ä½œæµç¨‹

### æ­¥é©Ÿ 1: æ–‡æ¡ˆç”Ÿæˆ
```bash
POST /api/staff/content/generate
{
  "topic": "å¸‚æ”¿å»ºè¨­æˆæœ",
  "style": "casual",      # formal/casual/humorous
  "length": "medium"      # short/medium/long
}
```

### æ­¥é©Ÿ 2a: äººå·¥ä¿®æ”¹
```bash
PUT /api/staff/content/task/{task_id}
{
  "content": "ä¿®æ”¹å¾Œçš„æ–‡æ¡ˆå…§å®¹...",
  "editor": "admin"
}
```

### æ­¥é©Ÿ 2b: å¯©æ ¸é€šé
```bash
POST /api/staff/content/task/{task_id}/approve
```

### æ­¥é©Ÿ 3: èªéŸ³å…‹éš†
```bash
POST /api/staff/media/voice/{task_id}
```

### æ­¥é©Ÿ 4: å½±ç‰‡ç”Ÿæˆ
```bash
POST /api/staff/media/video/{task_id}
{
  "image_path": "path/to/image.jpg",
  "prompt": "è‡ªç„¶å‹•æ…‹æ•ˆæœ"
}
```

---

## ğŸ§  LangChain æ¶æ§‹èªªæ˜

### æ°‘çœ¾å•ç­”ç³»çµ±
```
Agent (ReAct) 
  â””â”€> Tools
       â”œâ”€> æœå°‹çŸ¥è­˜åº« (RAG)
       â”œâ”€> æŸ¥è©¢æ”¿ç­–
       â””â”€> å„²å­˜è¨˜éŒ„
  â””â”€> Memory (ConversationBufferMemory)
```

### å¹•åƒšç³»çµ±
```
LLMChain (æ–‡æ¡ˆç”Ÿæˆ)
  â””â”€> Prompt (å«è¨˜æ†¶å­¸ç¿’)
  â””â”€> Memory (æ¯å€‹ä»»å‹™ç¨ç«‹è¨˜æ†¶)
  â””â”€> RAG (çŸ¥è­˜åº«æª¢ç´¢)
  â””â”€> æŒçºŒå­¸ç¿’ (å„²å­˜ä¿®æ”¹è¨˜éŒ„)
```

---

## ğŸ› ï¸ å¸¸ç”¨æŒ‡ä»¤

```bash
# å•Ÿå‹•æœå‹™
docker-compose up -d

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f public_api   # æ°‘çœ¾ç³»çµ±
docker-compose logs -f staff_api    # å¹•åƒšç³»çµ±

# é‡æ–°å•Ÿå‹•
docker-compose restart

# åœæ­¢æœå‹™
docker-compose down

# é‡æ–°å»ºç½®
docker-compose up -d --build

# é€²å…¥å®¹å™¨
docker exec -it pais-public-api bash
docker exec -it pais-staff-api bash

# æŸ¥çœ‹ç³»çµ±ç‹€æ…‹
curl http://localhost:8000/health    # æ°‘çœ¾ç³»çµ±
curl http://localhost:8001/health    # å¹•åƒšç³»çµ±
```

---

## ğŸ“Š è³‡æ–™åº«èªªæ˜

### Qdrant (å‘é‡è³‡æ–™åº«)
- å„²å­˜çŸ¥è­˜åº«æ–‡ä»¶å‘é‡
- å…©ç³»çµ±å…±ç”¨
- æ”¯æ´èªç¾©æœå°‹

### SQLite (å¹•åƒšç³»çµ±)
- `content_tasks` - æ–‡æ¡ˆä»»å‹™
- `content_versions` - æ–‡æ¡ˆç‰ˆæœ¬
- `media_records` - å¤šåª’é«”è¨˜éŒ„

---

## ğŸ”‘ ç’°å¢ƒè®Šæ•¸èªªæ˜

| è®Šæ•¸åç¨± | å¿…å¡« | èªªæ˜ |
|---------|------|------|
| GEMINI_API_KEY | âœ… | Google Gemini API Key |
| QDRANT_HOST | âœ… | Qdrant ä¸»æ©Ÿ (é è¨­: qdrant) |
| QDRANT_PORT | âœ… | Qdrant åŸ è™Ÿ (é è¨­: 6333) |
| ADMIN_PASSWORD | âœ… | ç®¡ç†å“¡å¯†ç¢¼ |
| STAFF_PASSWORD | âœ… | å¹•åƒšç³»çµ±å¯†ç¢¼ |
| ELEVENLABS_API_KEY | âŒ | ElevenLabs API Key |
| MAYOR_VOICE_ID | âŒ | å¸‚é•·èªéŸ³ ID |
| RUNWAY_API_KEY | âŒ | Runway API Key |

---

## âš ï¸ æ³¨æ„äº‹é …

### API Keys
- ElevenLabs å’Œ Runway éœ€è¦ä»˜è²»è¨‚é–±
- æ²’è¨­å®šçš„è©±å°æ‡‰åŠŸèƒ½ç„¡æ³•ä½¿ç”¨
- æ¸¬è©¦æ™‚å¯ä»¥å…ˆä¸å¡«ï¼Œè·³éèªéŸ³/å½±ç‰‡ç”Ÿæˆ

### è¨˜æ†¶ç®¡ç†
- è¨˜æ†¶æª”æ¡ˆæœƒæŒçºŒå¢é•·
- å»ºè­°å®šæœŸæ¸…ç†èˆŠä»»å‹™è¨˜æ†¶
- ä½ç½®: `chat_history/staff/`

### çŸ¥è­˜åº«
- å…©ç³»çµ±å…±ç”¨çŸ¥è­˜åº« (`documents/`)
- æ–‡æ¡ˆç”Ÿæˆæœƒå¾çŸ¥è­˜åº«æª¢ç´¢è³‡æ–™
- ç¢ºä¿ä¸Šå‚³è¶³å¤ çš„å¸‚æ”¿æ–‡ä»¶

### æ•ˆèƒ½
- åˆæ¬¡å•Ÿå‹•éœ€è¦ä¸‹è¼‰æ¨¡å‹ (ç´„ 1-2 åˆ†é˜)
- æ–‡æ¡ˆç”Ÿæˆæ™‚é–“ç´„ 5-15 ç§’
- èªéŸ³ç”Ÿæˆæ™‚é–“ç´„ 10-30 ç§’
- å½±ç‰‡ç”Ÿæˆæ™‚é–“ç´„ 1-5 åˆ†é˜

---

## ğŸ› å•é¡Œæ’æŸ¥

### å®¹å™¨å•Ÿå‹•å¤±æ•—
```bash
# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs

# é‡æ–°å»ºç½®
docker-compose down
docker-compose up -d --build
```

### API ç„¡æ³•é€£ç·š
```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps

# æª¢æŸ¥ç¶²è·¯
docker network ls
```

### çŸ¥è­˜åº«æª¢ç´¢å¤±æ•—
```bash
# ç¢ºèª Qdrant æ­£å¸¸é‹è¡Œ
curl http://localhost:6333/dashboard

# é‡æ–°å»ºç«‹ç´¢å¼•
docker exec -it pais-public-api python -c "from main import *; ingest_documents('documents')"
```

---

## ğŸ“ å¾…é–‹ç™¼åŠŸèƒ½

- [ ] å‰ç«¯ä»‹é¢å„ªåŒ–
- [ ] æ‰¹æ¬¡æ–‡æ¡ˆç”Ÿæˆ
- [ ] å®šæ™‚ä»»å‹™æ’ç¨‹
- [ ] æ›´å¤šèªéŸ³é¸é …
- [ ] å½±ç‰‡æ¨£å¼å®¢è£½åŒ–
- [ ] æ•¸æ“šåˆ†æé¢æ¿

---

## ğŸ‘¥ é–‹ç™¼åœ˜éšŠ

PAIS æ”¿å‹™åˆ†èº«æ™ºèƒ½ç³»çµ±é–‹ç™¼åœ˜éšŠ

---

## ğŸ“„ æˆæ¬Š

Â© 2024 PAIS Project. All rights reserved.